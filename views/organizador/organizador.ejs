<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LÃ­nea de Tiempo del Evento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Tema 1: Claulet ClÃ¡sico */
            --color-bg: #F8F9FA;
            --color-text: #252525;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #212529;
            --color-subtitle-text: #6C757D;
            --color-stat-value: #212529;
            --color-stat-label: #6C757D;
            --color-guest-name: #252525;
            --color-guest-message: #8C8C8C;
            --color-btn-excel: #BDB9A6;
            --color-btn-excel-hover: #A3A090;
        }

        /* Tema 2: Claulet Elegante */
        body[data-theme="claulet-elegante"] {
            --color-bg: #EAE3D2;
            --color-text: #4A4A4A;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.1);
            --color-header-text: #8B4513;
            --color-subtitle-text: #A1887F;
            --color-stat-value: #8B4513;
            --color-stat-label: #A1887F;
            --color-guest-name: #8B4513;
            --color-guest-message: #A1887F;
            --color-btn-excel: #B08E66;
            --color-btn-excel-hover: #8D6E5D;
        }

        /* Tema 3: Claulet Oscuro */
        body[data-theme="claulet-oscuro"] {
            --color-bg: #222222;
            --color-text: #F8F9FA;
            --color-card-bg: #333333;
            --color-card-shadow: rgba(0, 0, 0, 0.2);
            --color-header-text: #FFD700;
            --color-subtitle-text: #BDB76B;
            --color-stat-value: #FFD700;
            --color-stat-label: #BDB76B;
            --color-guest-name: #FFD700;
            --color-guest-message: #BDB76B;
            --color-btn-excel: #FFD700;
            --color-btn-excel-hover: #EBC800;
        }

        /* Tema 4: Claulet Contraste */
        body[data-theme="claulet-contraste"] {
            --color-bg: #333333;
            --color-text: #fff;
            --color-card-bg: #1c1c1c;
            --color-card-shadow: rgba(0, 0, 0, 0.3);
            --color-header-text: #E53935;
            --color-subtitle-text: #B3B3B3;
            --color-stat-value: #E53935;
            --color-stat-label: #B3B3B3;
            --color-guest-name: #E53935;
            --color-guest-message: #B3B3B3;
            --color-btn-excel: #B3B3B3;
            --color-btn-excel-hover: #8F8F8F;
        }

        /* Tema 5: Claulet Natural */
        body[data-theme="claulet-natural"] {
            --color-bg: #EDF2F4;
            --color-text: #2B2D42;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #2B2D42;
            --color-subtitle-text: #8D99AE;
            --color-stat-value: #2B2D42;
            --color-stat-label: #8D99AE;
            --color-guest-name: #2B2D42;
            --color-guest-message: #8D99AE;
            --color-btn-excel: #52637D;
            --color-btn-excel-hover: #3E4B65;
        }

        /* Tema 6: Claulet Terracota */
        body[data-theme="claulet-terracota"] {
            --color-bg: #FEF7F5;
            --color-text: #5A5255;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.08);
            --color-header-text: #D07B64;
            --color-subtitle-text: #8C7873;
            --color-stat-value: #D07B64;
            --color-stat-label: #8C7873;
            --color-guest-name: #D07B64;
            --color-guest-message: #8C7873;
            --color-btn-excel: #D07B64;
            --color-btn-excel-hover: #B86550;
        }

        /* Tema 7: Claulet Ceniza */
        body[data-theme="claulet-ceniza"] {
            --color-bg: #EAEAEF;
            --color-text: #41444B;
            --color-card-bg: #FFFFFF;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #41444B;
            --color-subtitle-text: #868892;
            --color-stat-value: #41444B;
            --color-stat-label: #868892;
            --color-guest-name: #41444B;
            --color-guest-message: #868892;
            --color-btn-excel: #7F848C;
            --color-btn-excel-hover: #6D727A;
        }

        /* Tema 8: Claulet Moderno */
        body[data-theme="claulet-moderno"] {
            --color-bg: #F5F5F5;
            --color-text: #212121;
            --color-card-bg: #FFFFFF;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #212121;
            --color-subtitle-text: #757575;
            --color-stat-value: #212121;
            --color-stat-label: #757575;
            --color-guest-name: #212121;
            --color-guest-message: #757575;
            --color-btn-excel: #B0BEC5;
            --color-btn-excel-hover: #90A4AE;
        }

        /* Tema 9: Claulet Fino */
        body[data-theme="claulet-fino"] {
            --color-bg: #FDF9F3;
            --color-text: #424242;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.08);
            --color-header-text: #D2AA5C;
            --color-subtitle-text: #A1887F;
            --color-stat-value: #D2AA5C;
            --color-stat-label: #A1887F;
            --color-guest-name: #D2AA5C;
            --color-guest-message: #A1887F;
            --color-btn-excel: #D2AA5C;
            --color-btn-excel-hover: #C29F59;
        }

        /* Tema 10: Claulet Suave */
        body[data-theme="claulet-suave"] {
            --color-bg: #F8F4E3;
            --color-text: #5A5A5A;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #A1887F;
            --color-subtitle-text: #A1887F;
            --color-stat-value: #A1887F;
            --color-stat-label: #A1887F;
            --color-guest-name: #A1887F;
            --color-guest-message: #A1887F;
            --color-btn-excel: #C2B3A3;
            --color-btn-excel-hover: #B3A495;
        }

        /* Tema 11: Marino */
        body[data-theme="marino"] {
            --color-bg: #E3F2FD;
            --color-text: #1976D2;
            --color-card-bg: #BBDEFB;
            --color-card-shadow: rgba(0, 0, 0, 0.1);
            --color-header-text: #0D47A1;
            --color-subtitle-text: #1976D2;
            --color-stat-value: #0D47A1;
            --color-stat-label: #1976D2;
            --color-guest-name: #0D47A1;
            --color-guest-message: #1976D2;
            --color-btn-excel: #0D47A1;
            --color-btn-excel-hover: #083363;
        }

        /* Tema 12: Primavera */
        body[data-theme="primavera"] {
            --color-bg: #F8BBD0;
            --color-text: #8E24AA;
            --color-card-bg: #FCE4EC;
            --color-card-shadow: rgba(0, 0, 0, 0.08);
            --color-header-text: #D81B60;
            --color-subtitle-text: #FF9800;
            --color-stat-value: #D81B60;
            --color-stat-label: #FF9800;
            --color-guest-name: #D81B60;
            --color-guest-message: #FF9800;
            --color-btn-excel: #F48FB1;
            --color-btn-excel-hover: #C2185B;
        }

        /* Tema 13: Urbano */
        body[data-theme="urbano"] {
            --color-bg: #212121;
            --color-text: #E0E0E0;
            --color-card-bg: #424242;
            --color-card-shadow: rgba(0, 0, 0, 0.25);
            --color-header-text: #FFEB3B;
            --color-subtitle-text: #9E9E9E;
            --color-stat-value: #FFEB3B;
            --color-stat-label: #9E9E9E;
            --color-guest-name: #FFEB3B;
            --color-guest-message: #9E9E9E;
            --color-btn-excel: #9E9E9E;
            --color-btn-excel-hover: #757575;
        }

        /* Tema 14: Vino */
        body[data-theme="vino"] {
            --color-bg: #F5EFE7;
            --color-text: #4E342E;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.08);
            --color-header-text: #5D4037;
            --color-subtitle-text: #8D6E63;
            --color-stat-value: #5D4037;
            --color-stat-label: #8D6E63;
            --color-guest-name: #5D4037;
            --color-guest-message: #8D6E63;
            --color-btn-excel: #880E4F;
            --color-btn-excel-hover: #4A1429;
        }

        /* Tema 15: Bosque */
        body[data-theme="bosque"] {
            --color-bg: #E8F5E9;
            --color-text: #1B5E20;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0, 0, 0, 0.05);
            --color-header-text: #2E7D32;
            --color-subtitle-text: #66BB6A;
            --color-stat-value: #2E7D32;
            --color-stat-label: #66BB6A;
            --color-guest-name: #2E7D32;
            --color-guest-message: #66BB6A;
            --color-btn-excel: #2E7D32;
            --color-btn-excel-hover: #1B5E20;
        }

        /* Tema 16: Spotify */
        body[data-theme="spotify"] {
            --color-bg: #121212;
            --color-text: #fff;
            --color-card-bg: #181818;
            --color-card-shadow: rgba(0, 0, 0, 0.3);
            --color-header-text: #fff;
            --color-subtitle-text: #a7a7a7;
            --color-stat-value: #1DB954;
            --color-stat-label: #a7a7a7;
            --color-guest-name: #fff;
            --color-guest-message: #b3b3b3;
            --color-btn-excel: #1DB954;
            --color-btn-excel-hover: #1ed760;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }

        .top-bar {
            background-color: var(--color-card-bg);
            color: var(--color-text);
        }

        .dashboard-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .stat-card {
            background-color: var(--color-card-bg);
            box-shadow: 0 4px 6px var(--color-card-shadow);
            padding: 10px;
            /* Nuevo padding */
            border-radius: 10px;
            /* Borde redondeado */
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-stat-value);
        }

        .stat-label {
            color: var(--color-stat-label);
            font-weight: 500;
        }

        .timeline-container {
            position: relative;
            padding-left: 50px;
        }

        .timeline-container:before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #E2E8F0;
        }

        .timeline-card {
            background-color: var(--color-card-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px var(--color-card-shadow);
            margin-bottom: 2rem;
            position: relative;
        }

        .timeline-card:before {
            content: '';
            position: absolute;
            left: -15px;
            top: 1.5rem;
            width: 10px;
            height: 10px;
            background-color: var(--color-stat-label);
            border-radius: 50%;
        }

        .guest-name {
            font-family: 'Caveat', cursive;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-guest-name);
        }

        .guest-message {
            font-size: 1rem;
            font-style: italic;
            color: var(--color-guest-message);
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .guest-details {
            font-size: 0.9rem;
            color: #6C757D;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #E2E8F0;
        }

        /* Estilos para mÃ³viles */
        @media (max-width: 767px) {
            .timeline-container {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .timeline-container:before {
                left: 0;
                display: none;
            }

            .timeline-card:before {
                display: none;
            }
        }
    </style>
</head>

<body data-theme="claulet-clasico">

    <!-- Franja superior -->
    <div class="top-bar shadow-md py-4 px-6 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <img src="https://placehold.co/40x40/E5E7EB/A1A1AA?text=Logo" alt="Logo del evento" class="h-10">
        </div>
        <div class="flex items-center space-x-4">
            <div class="text-sm">
                Bienvenida, <%= usuario.nombre %> ðŸ‘‹
            </div>
            <select id="theme-selector" class="px-3 py-1 rounded-md text-sm border border-gray-300">
                <option value="claulet-clasico">Claulet ClÃ¡sico</option>
                <option value="claulet-elegante">Claulet Elegante</option>
                <option value="claulet-oscuro">Claulet Oscuro</option>
                <option value="claulet-contraste">Claulet Contraste</option>
                <option value="claulet-natural">Claulet Natural</option>
                <option value="claulet-terracota">Claulet Terracota</option>
                <option value="claulet-ceniza">Claulet Ceniza</option>
                <option value="claulet-moderno">Claulet Moderno</option>
                <option value="claulet-fino">Claulet Fino</option>
                <option value="claulet-suave">Claulet Suave</option>
                <option value="marino">Marino</option>
                <option value="primavera">Primavera</option>
                <option value="urbano">Urbano</option>
                <option value="vino">Vino</option>
                <option value="bosque">Bosque</option>
                <option value="spotify">Spotify</option>
            </select>
        </div>
    </div>

    <div class="dashboard-container">
        <header class="mb-8">
            <h1 class="text-3xl font-bold mb-2" style="color: var(--color-header-text);">Panel para Organizadores</h1>
            <p class="text-gray-500" style="color: var(--color-subtitle-text);">Administra los mensajes y la informaciÃ³n
                del evento.</p>
        </header>

        <!-- SecciÃ³n de estadÃ­sticas -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="stat-card">
                <!-- âœ… CAMBIO: De 155 a <%= stats.total %> -->
                <div class="stat-value">
                    <%= stats.total %>
                </div>
                <div class="stat-label">Total Invitados</div>
            </div>
            <div class="stat-card">
                <!-- âœ… CAMBIO: De 120 a <%= stats.confirmados %> -->
                <div class="stat-value text-green-500">
                    <%= stats.confirmados %>
                </div>
                <div class="stat-label">Confirmados</div>
            </div>
            <div class="stat-card">
                <!-- âœ… CAMBIO: De 30 a <%= stats.pendientes %> -->
                <div class="stat-value text-yellow-500">
                    <%= stats.pendientes %>
                </div>
                <div class="stat-label">Pendientes</div>
            </div>
            <div class="stat-card">
                <!-- âœ… CAMBIO: De 5 a <%= stats.declinados %> -->
                <div class="stat-value text-red-500">
                    <%= stats.declinados %>
                </div>
                <div class="stat-label">Declinados</div>
            </div>
        </div>

        <!-- SecciÃ³n de filtros y acciones -->
        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div class="relative w-full md:w-1/3">
                <input type="text" id="guest-search" placeholder="Buscar invitado por nombre..."
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
            <div class="relative w-full md:w-1/3">
                <select name="evento" id="event-filter"
                    class="w-full px-4 py-2 border rounded-md appearance-none focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white pr-8">
                    <option value="all">Todos los eventos</option>
                    <% eventos.forEach(evento=> { %>
                        <option value="<%= evento.id %>">
                            <%= evento.nombre %>
                        </option>
                        <% }) %>
                </select>
            </div>

            <!-- Bonton exportar excel -->
            <!-- organizador.ejs -->

            <div class="flex gap-2 w-full md:w-auto">
                <!-- âœ… MODIFICADO: Agregar evento click -->
                <button id="export-excel-btn"
                    class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-md transition-colors w-1/2 md:w-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                    <span id="export-btn-text">Exportar Excel</span>
                </button>
            </div>
        </div>

        <!-- Contenedor de la lÃ­nea de tiempo -->
        <div class="timeline-container" id="timeline-feed">
            <% eventos.forEach(evento=> { %>
                <h2 class="text-xl font-bold mb-2 mt-4 event-title" data-event-id="<%= evento.id %>">
                    <%= evento.nombre %>
                </h2>

                <% if (evento.invitados && evento.invitados.length> 0) { %>
                    <% evento.invitados.forEach(guest=> { %>
                        <!-- âœ… NUEVO: Agregamos data-event-id y data-guest-name para filtrado -->
                        <div class="timeline-card mb-4 p-4 border rounded-md shadow-sm" data-event-id="<%= evento.id %>"
                            data-guest-name="<%= guest.nombre.toLowerCase() %> <%= guest.apellidos.toLowerCase() %>"
                            data-guest-status="<%= guest.estado ? guest.estado.toLowerCase() : 'pendiente' %>">

                            <div class="flex flex-col md:flex-row md:items-center justify-between mb-2">
                                <div class="guest-name font-semibold text-lg">
                                    <%= guest.nombre %>
                                        <%= guest.apellidos %>
                                </div>
                                <div class="flex space-x-2 items-center mt-2 md:mt-0">
                                    <span class="text-xs font-semibold uppercase 
                <%= guest.estado === 'confirmado' ? 'text-green-500' : 
                    guest.estado === 'pendiente' ? 'text-yellow-500' : 'text-red-500' %>">
                                        <%= guest.estado %>
                                    </span>
                                </div>
                            </div>

                            <div class="guest-message text-gray-700 mb-1">
                                <%= guest.deseo || '' %>
                            </div>

                            <div class="guest-details text-sm text-gray-500">
                                <% let detalles=[]; if (guest.comentarios) detalles.push(`Comentarios:
                                    ${guest.comentarios}`); if (guest.seccion) detalles.push(`SecciÃ³n:
                                    ${guest.seccion}`); if (guest.tipo) detalles.push(`Tipo: ${guest.tipo}`); %>
                                    <%= detalles.join(' | ') %>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-gray-400 mb-4 no-guests-message" data-event-id="<%= evento.id %>">
        No hay invitados para este evento.
      </p>
    <% } %>
  <% }) %>
</div>


    </div>

    <script>
        // âœ… Pasar datos del servidor al JavaScript
        window.ORGANIZADOR_DATA = {
            usuarioId: '<%= usuario.id %>',
            usuarioNombre: ' <%=usuario.nombre %>'
        };
    </script>

    <script src="/organizadorPublic.js"></script>

</body>

</body>

</html>